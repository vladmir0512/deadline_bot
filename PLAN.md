# План разработки Telegram бота для дедлайнов

## Этап 1: Инициализация проекта ✅
- [x] Создать виртуальное окружение
- [x] Установить зависимости (aiogram, python-dotenv)
- [x] Создать requirements.txt с фиксированными версиями
- [x] Настроить .gitignore
- [x] Создать README.md
- [x] Создать MIT лицензию
- [x] Настроить .env файл для чувствительных данных

## Этап 2: Проектирование модели данных ✅
- [x] Спроектировать структуру БД:
  - Таблица `users` (telegram_id, username, email, created_at)
  - Таблица `deadlines` (id, user_identifier, title, description, due_date, status, source, created_at, updated_at)
  - Таблица `subscriptions` (user_id, notification_type, active)
- [x] Настроить SQLAlchemy для работы с SQLite
- [x] Создать модели и миграции

## Этап 3: Сервис интеграции с Yonote ✅
- [x] Исследовать API Yonote (v2 и CSV экспорт API)
- [x] Создать модуль для запросов к Yonote API
- [x] Реализовать парсинг ответов и извлечение дедлайнов
- [x] Настроить фильтрацию по пользователям (email/ник)
- [x] Добавить обработку ошибок и повторные попытки
- [x] Интегрировать CSV экспорт API для более точного определения назначенных пользователей
- [x] Обеспечить корректное определение полей типа "люди" и "дата"

## Этап 4: Telegram бот - основные команды ✅
- [x] Команда `/start` - регистрация пользователя
- [x] Команда `/help` - справка
- [x] Команда `/register` - привязка только ника к Telegram аккаунту (email больше не поддерживается)
- [x] Команда `/logout` - отписка от уведомлений и сброс данных
- [x] Команда `/my_deadlines` - показать личные дедлайны
- [x] Команда `/subscribe` - подписка/отписка от уведомлений
- [x] Команда `/sync` - ручная синхронизация дедлайнов
- [x] Проверка, что пользователь зарегистрирован с ником для получения дедлайнов

## Этап 5: Планировщик и уведомления ✅
- [x] Настроить фоновый планировщик (apscheduler)
- [x] Реализовать периодический опрос Yonote API через CSV экспорт
- [x] Создать систему уведомлений о приближающихся дедлайнах
- [x] Добавить фильтры по времени (сегодня, завтра, неделя)
- [x] Предотвратить дублирование уведомлений
- [x] Добавить периодическую очистку просроченных/завершенных дедлайнов

## Этап 6: Тестирование и отладка ✅
- [x] Написать unit тесты для моделей и сервисов
- [x] Протестировать интеграцию с Yonote (CSV и v2 API)
- [x] Тестирование бота с несколькими пользователями
- [x] Добавить логирование
- [x] Проверка и улучшение точности сопоставления пользователей с дедлайнами

## Этап 7: Деплой и мониторинг
- [ ] Создать Dockerfile
- [ ] Настроить CI/CD (GitHub Actions)
- [ ] Выбрать платформу для деплоя (Heroku, Railway, VPS)
- [ ] Настроить мониторинг и алерты

## Этап 8: Документация и оптимизация
- [ ] Полная документация API
- [ ] Руководство пользователя
- [ ] Оптимизация производительности
- [ ] Добавление новых функций по запросам

## Технологии
- Python 3.8+
- aiogram 3.x (Telegram Bot API)
- SQLAlchemy (ORM для SQLite)
- python-dotenv (переменные окружения)
- apscheduler (планировщик задач)
- aiohttp (HTTP запросы к Yonote через CSV экспорт)
- requests (альтернативные HTTP запросы)

## Переменные окружения
```
TELEGRAM_BOT_TOKEN=токен_бота_из_BotFather
YONOTE_API_KEY=ключ_API_Yonote
YONOTE_CALENDAR_ID=ID_календаря_в_Yonote
DATABASE_URL=sqlite:///deadlines.db
UPDATE_INTERVAL_MINUTES=30
```
